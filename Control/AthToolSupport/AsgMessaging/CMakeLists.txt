# Copyright (C) 2002-2021 CERN for the benefit of the ATLAS collaboration.

# Declare the package name:
atlas_subdir( AsgMessaging )

# Dependencies are taken based on what environment we are in:
if( XAOD_STANDALONE )
   set( extra_libs )
else()
   set( extra_libs GaudiKernel AthenaBaseComps )
endif()

# Decide which sources to use:
if( XAOD_STANDALONE )
   set( sources Root/*.cxx )
else()
   set( sources Root/MsgLevel.cxx
      Root/AsgMessaging.cxx Root/AsgMessagingForward.cxx Root/MsgHelpers.cxx
      Root/MessageCheck.cxx Root/MessageCheckLocal.cxx src/*.cxx )
endif()

# Component(s) in the package:
atlas_add_library( AsgMessagingLib
   AsgMessaging/*.h AsgMessaging/*.icc ${sources}
   PUBLIC_HEADERS AsgMessaging
   LINK_LIBRARIES CxxUtils ${extra_libs} )

# Select which xml files to use for dictionary generation

atlas_add_dictionary( AsgMessagingDict
   AsgMessaging/AsgMessagingDict.h AsgMessaging/selection.xml
   LINK_LIBRARIES AsgMessagingLib )

if( XAOD_STANDALONE )
    atlas_add_dictionary( AsgMessagingStandaloneDict
    AsgMessaging/AsgMessagingStandaloneDict.h AsgMessaging/selection_StandAlone.xml
    LINK_LIBRARIES AsgMessagingLib )
endif()

# Silence some warnings that are generated by the code on MacOS X:
set( extra_defs )
if( APPLE AND TARGET AsgMessaging )
   target_compile_options( AsgMessaging PUBLIC -Wno-tautological-undefined-compare )
endif()

# Test(s) in the package:

atlas_add_test( ut_asgmessaging_statuscode
   SOURCES test/ut_asgmessaging_statuscode.cxx
   LINK_LIBRARIES AsgMessagingLib
   POST_EXEC_SCRIPT nopost.sh )
